!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).shpwriter={})}(this,(function(t){"use strict";function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){u(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new O(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return N()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var u=b(a,n);if(u){if(u===s)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var f=l(t,e,n);if("normal"===f.type){if(r=n.done?"completed":"suspendedYield",f.arg===s)continue;return{value:f.arg,done:n.done}}"throw"===f.type&&(r="completed",n.method="throw",n.arg=f.arg)}}}(t,n,a),i}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var s={};function h(){}function m(){}function p(){}var v={};f(v,i,(function(){return this}));var d=Object.getPrototypeOf,g=d&&d(d(I([])));g&&g!==e&&n.call(g,i)&&(v=g);var y=p.prototype=h.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(o,i,a,u){var f=l(t[o],t,i);if("throw"!==f.type){var c=f.arg,s=c.value;return s&&"object"==typeof s&&n.call(s,"__await")?e.resolve(s.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(s).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(f.arg)}var o;this._invoke=function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}}function b(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method))return s;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var r=l(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,s;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function E(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function I(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:N}}function N(){return{value:void 0,done:!0}}return m.prototype=p,f(y,"constructor",p),f(p,"constructor",m),m.displayName=f(p,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,f(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},w(x.prototype),f(x.prototype,a,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(c(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(y),f(y,u,"Generator"),f(y,i,(function(){return this})),f(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=I,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),f=n.call(i,"finallyLoc");if(u&&f){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!f)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),E(n),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:I(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),s}},t}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e,n,r,o,i,a){try{var u=t[i](a),f=u.value}catch(t){return void n(t)}u.done?e(f):Promise.resolve(f).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function u(t){i(a,r,o,u,f,"next",t)}function f(t){i(a,r,o,u,f,"throw",t)}u(void 0)}))}}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f={geometries:{NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULTIPOINTM:28,MULTIPATCH:31}},c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l={},s={lpad:function(t,e,n){for(;t.length<e;)t=n+t;return t},rpad:function(t,e,n){for(;t.length<e;)t+=n;return t},writeField:function(t,e,n,r){for(var o=0;o<e;o++)t.setUint8(r,n.charCodeAt(o)),r++;return r}},h={},m={C:254,L:1,D:8,N:18,M:18,F:18,B:8},p={string:"C",number:"N",boolean:"L",null:"C"};function v(t){var e={},n=[];for(var r in t)e[r]=null===t[r]?"null":typeof t[r];for(var o in e){var i=p[e[o]];i&&n.push({name:o,type:i,size:m[i]})}return n}h.multi=function(t){var e={};function n(t){!function(t,e){for(var n in e){var r=void 0!==e[n]&&null!==e[n];(void 0===t[n]||r)&&(t[n]=e[n])}}(e,t)}return t.forEach(n),v(e)},h.bytesPer=function(t){return t.reduce((function(t,e){return t+e.size}),1)},h.obj=v;var d=s,g=h;l.structure=function(t,e){var n=e||g.multi(t),r=32*n.length+1,o=g.bytesPer(n),i=new ArrayBuffer(r+32+o*t.length+1),a=new Date,u=new DataView(i);u.setUint8(0,3),u.setUint8(1,a.getFullYear()-1900),u.setUint8(2,a.getMonth()),u.setUint8(3,a.getDate()),u.setUint32(4,t.length,!0);var f=r+32;return u.setUint16(8,f,!0),u.setUint16(10,o,!0),u.setInt8(32+r-1,13),n.forEach((function(t,e){t.name.split("").slice(0,8).forEach((function(t,n){u.setInt8(32+32*e+n,t.charCodeAt(0))})),u.setInt8(32+32*e+11,t.type.charCodeAt(0)),u.setInt8(32+32*e+16,t.size),"N"==t.type&&u.setInt8(32+32*e+17,3)})),offset=r+32,t.forEach((function(t,e){u.setUint8(offset,32),offset++,n.forEach((function(e){var n=t[e.name];switch(null==n&&(n=""),e.type){case"L":u.setUint8(offset,n?84:70),offset++;break;case"D":offset=d.writeField(u,8,d.lpad(n.toString(),8," "),offset);break;case"N":offset=d.writeField(u,e.size,d.lpad(n.toString(),e.size," ").substr(0,18),offset);break;case"C":offset=d.writeField(u,e.size,d.rpad(n.toString(),e.size," "),offset);break;default:throw new Error("Unknown field type")}}))})),u.setUint8(offset,26),u};var y='GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]';var w={enlarge:function(t,e){return e[0]<t.xmin&&(t.xmin=e[0]),e[0]>t.xmax&&(t.xmax=e[0]),e[1]<t.ymin&&(t.ymin=e[1]),e[1]>t.ymax&&(t.ymax=e[1]),(e[2]||0)<t.zmin&&(t.zmin=e[2]||0),(e[2]||0)>t.zmax&&(t.zmax=e[2]||0),(e[3]||0)<t.mmin&&(t.mmin=e[3]||0),(e[3]||0)>t.mmax&&(t.mmax=e[3]||0),t},blank:function(){return{xmin:Number.MAX_VALUE,ymin:Number.MAX_VALUE,zmin:Number.MAX_VALUE,mmin:Number.MAX_VALUE,xmax:-Number.MAX_VALUE,ymax:-Number.MAX_VALUE,zmax:-Number.MAX_VALUE,mmax:-Number.MAX_VALUE}},enlargeExtent:function(t,e){return e.xmax>t.xmax&&(t.xmax=e.xmax),e.xmin<t.xmin&&(t.xmin=e.xmin),e.ymax>t.ymax&&(t.ymax=e.ymax),e.ymin<t.ymin&&(t.ymin=e.ymin),e.zmax&&e.zmax>t.zmax&&(t.zmax=e.zmax),e.zmin&&e.zmin<t.zmin&&(t.zmin=e.zmin),e.mmax&&e.mmax>t.mmax&&(t.mmax=e.mmax),e.mmin&&e.mmin<t.mmin&&(t.mmin=e.mmin),t}};var x={write:function(t,e,n,r,o){var i=o===f.geometries.POINTZ,a=i?36:20,u=100,c=0,l=0;t.forEach((function(t,e){n.setInt32(c,e),n.setInt32(c+4,a/2),n.setInt32(c+8,o,!0),n.setFloat64(c+12,t[0],!0),n.setFloat64(c+20,t[1],!0),i&&(n.setFloat64(c+28,t[2]||0,!0),n.setFloat64(c+36,t[3]||0,!0)),r.setInt32(l,u/2),r.setInt32(l+4,a/2),l+=8,c+=a+8,u+=a+8}))},parts:function(t,e){return t.length},extent:function(t){return t.reduce((function(t,e){return w.enlarge(t,e)}),w.blank())},shxLength:function(t){return 8*t.length},shpLength:function(t,e){return t.length*(e===f.geometries.POINTZ?44:28)}};function b(t){return t.reduce((function(t,e){return t.concat(e)}),[])}var L={write:function(t,e,n,r,o){var i=0,a=0,u=100,c=o===f.geometries.MULTIPOINTZ;t.forEach((function(t,e){var f=40+16*t.length;c&&(f+=32+16*t.length);var l=f+8,s=t.reduce((function(t,e){return w.enlarge(t,e)}),w.blank());r.setInt32(a,u/2),r.setInt32(a+4,l/2),a+=8,u+=l,n.setInt32(i,e),n.setInt32(i+4,f/2),n.setInt32(i+8,o,!0),n.setFloat64(i+12,s.xmin,!0),n.setFloat64(i+20,s.ymin,!0),n.setFloat64(i+28,s.xmax,!0),n.setFloat64(i+36,s.ymax,!0),n.setInt32(i+44,t.length,!0),i+=48;var h=Number.MAX_VALUE,m=-Number.MAX_VALUE,p=Number.MAX_VALUE,v=-Number.MAX_VALUE;t.forEach((function(e,r){(t[2]||0)<h&&(h=t[2]||0),(t[2]||0)>m&&(m=t[2]||0),(t[3]||0)<p&&(p=t[3]||0),(t[3]||0)>v&&(v=t[3]||0),n.setFloat64(i,e[0],!0),n.setFloat64(i+8,e[1],!0),i+=16})),c&&(n.setFloat64(i,h,!0),n.setFloat64(i+8,m,!0),i+=16,t.forEach((function(t,e){n.setFloat64(i,t[2]||0,!0),i+=8})),n.setFloat64(i,p,!0),n.setFloat64(i+8,v,!0),i+=16,t.forEach((function(t,e){n.setFloat64(i,t[3]||0,!0),i+=8})))}))},parts:function(t,e){return t.length},extent:function(t){return b(t).reduce((function(t,e){return w.enlarge(t,e)}),w.blank())},shxLength:function(t){return 8*t.length},shpLength:function(t,e){var n=b(t),r=48*t.length+16*n.length;return e===f.geometries.MULTIPOINTZ&&(r+=32*t.length+16*n.length),r}};function E(t,e){return t.length}function O(t,e){return void 0===e&&(e=[]),"object"==o(t[0][0])?t.reduce((function(t,e){return Array.prototype.push.apply(t,O(e)),t}),e):t}var I={write:function(t,e,n,r,o){var i=0,a=0,u=100,c=o===f.geometries.POLYLINEZ||o===f.geometries.POLYGONZ;t.forEach((function(t,e){var l=O(t),s=o===f.geometries.POLYLINE||o===f.geometries.POLYLINEZ?E([t]):E(t),h=16*l.length+48+4*(s-1);c&&(h+=32+16*l.length);var m=l.reduce((function(t,e){return w.enlarge(t,e)}),w.blank());r.setInt32(a,u/2),r.setInt32(a+4,h/2),a+=8,u+=h+8,n.setInt32(i,e+1),n.setInt32(i+4,h/2),n.setInt32(i+8,o,!0),n.setFloat64(i+12,m.xmin,!0),n.setFloat64(i+20,m.ymin,!0),n.setFloat64(i+28,m.xmax,!0),n.setFloat64(i+36,m.ymax,!0),n.setInt32(i+44,s,!0),n.setInt32(i+48,l.length,!0),n.setInt32(i+52,0,!0);for(var p=t.reduce((function(t,e){return Array.isArray(e[0][0])?t=t.concat(e):t.push(e),t}),[]),v=1;v<s;v++){var d=p.reduce((function(t,e,n){return n<v?t+e.length:t}),0);n.setInt32(i+52+4*v,d,!0)}i+=56+4*(s-1),l.forEach((function(t,e){n.setFloat64(i,t[0],!0),n.setFloat64(i+8,t[1],!0),i+=16})),c&&(n.setFloat64(i,m.zmin,!0),n.setFloat64(i+8,m.zmax,!0),i+=16,l.forEach((function(t,e){n.setFloat64(i,t[2]||0,!0),i+=8})),n.setFloat64(i,m.mmin,!0),n.setFloat64(i+8,m.mmax,!0),i+=16,l.forEach((function(t,e){n.setFloat64(i,t[3]||0,!0),i+=8})))}))},parts:E,extent:function(t){return O(t).reduce((function(t,e){return w.enlarge(t,e)}),w.blank())},shxLength:function(t){return 8*t.length},shpLength:function(t,e){var n=0,r=e===f.geometries.POLYLINEZ||e===f.geometries.POLYGONZ;return t.forEach((function(t,e){var o=t.length,i=O(t),a=44+4*o+16*i.length+8;r&&(a+=16+8*i.length+(16+8*i.length)),n+=a})),n},justCoords:O};"undefined"!=typeof window&&(window.offset=void 0),"undefined"!=typeof globalThis&&(globalThis.offset=void 0);var N={1:x,3:I,5:I,8:L,11:x,13:I,15:I,18:L};function P(t,e,n,r){var o=f.geometries[e],i=N[o],a=i.parts(n,o),u=100+i.shpLength(n,o),c=100+i.shxLength(n),s=new ArrayBuffer(u),h=new DataView(s),m=new ArrayBuffer(c),p=new DataView(m),v=i.extent(n);T(h,o),T(p,o),A(v,h),A(v,p),i.write(n,v,new DataView(s,100),new DataView(m,100),o),h.setInt32(24,u/2),p.setInt32(24,50+4*a),r(null,{shp:h,shx:p,dbf:l.structure(t),prj:y})}function T(t,e){t.setInt32(0,9994),t.setInt32(28,1e3,!0),t.setInt32(32,e,!0)}function A(t,e){e.setFloat64(36,t.xmin,!0),e.setFloat64(44,t.ymin,!0),e.setFloat64(52,t.xmax,!0),e.setFloat64(60,t.ymax,!0),e.setFloat64(68,t.zmin,!0),e.setFloat64(76,t.zmax,!0),e.setFloat64(84,t.mmin,!0),e.setFloat64(92,t.mmax,!0)}var M={point:F("Point","POINT",!1),pointZ:F("Point","POINTZ",!0),multipoint:F("MultiPoint","MULTIPOINT",!1),multipointZ:F("MultiPoint","MULTIPOINTZ",!0),line:F("LineString","POLYLINE",!1),lineZ:F("LineString","POLYLINEZ",!0),multiline:F("MultiLineString","POLYLINE",!1),multilineZ:F("MultiLineString","POLYLINEZ",!0),polygon:F("Polygon","POLYGON",!1),polygonZ:F("Polygon","POLYGONZ",!0)};function F(t,e,n){return function(r){var o,i,a,u=r.features.filter((o=t,function(t){return t.geometry.type===o})).filter(function(t,e){return function(n){var r;return r="POINT"===t||"POINTZ"===t?[n.geometry.coordinates]:Array.isArray(n.geometry.coordinates[0][0])?n.geometry.coordinates.reduce((function(t,e){return t.concat(e)}),[]):n.geometry.coordinates,e?r.some((function(t){return t.length>=3})):r.every((function(t){return 2===t.length}))}}(e,n));if("MultiLineString"===t||"MultiPoint"===t){var f=u.map(U);i=[].concat.apply([],f);var c=u.map(z);a=[].concat.apply([],c)}else i=u.map(S),a=u.map(_);return{geometries:i,properties:a,type:e}}}function S(t){return t.geometry.coordinates}function U(t){return t.geometry.coordinates.map((function(t){return[t]}))}function _(t){return t.properties}function z(t){var e=[];return t.geometry.coordinates.forEach((function(){e.push(t.properties)})),e}var j=Uint8Array,k=Uint16Array,Z=Uint32Array,D=new j([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Y=new j([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),G=new j([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),C=function(t,e){for(var n=new k(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var o=new Z(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)o[i]=i-n[r]<<5|r;return[n,o]},V=C(D,2),R=V[0],X=V[1];R[28]=258,X[258]=28;for(var B=C(Y,0)[1],H=new k(32768),W=0;W<32768;++W){var q=(43690&W)>>>1|(21845&W)<<1;q=(61680&(q=(52428&q)>>>2|(13107&q)<<2))>>>4|(3855&q)<<4,H[W]=((65280&q)>>>8|(255&q)<<8)>>>1}var J=function(t,e,n){for(var r=t.length,o=0,i=new k(e);o<r;++o)t[o]&&++i[t[o]-1];var a,u=new k(e);for(o=0;o<e;++o)u[o]=u[o-1]+i[o-1]<<1;if(n){a=new k(1<<e);var f=15-e;for(o=0;o<r;++o)if(t[o])for(var c=o<<4|t[o],l=e-t[o],s=u[t[o]-1]++<<l,h=s|(1<<l)-1;s<=h;++s)a[H[s]>>>f]=c}else for(a=new k(r),o=0;o<r;++o)t[o]&&(a[o]=H[u[t[o]-1]++]>>>15-t[o]);return a},K=new j(288);for(W=0;W<144;++W)K[W]=8;for(W=144;W<256;++W)K[W]=9;for(W=256;W<280;++W)K[W]=7;for(W=280;W<288;++W)K[W]=8;var Q=new j(32);for(W=0;W<32;++W)Q[W]=5;var $=J(K,9,0),tt=J(Q,5,0),et=function(t){return(t+7)/8|0},nt=function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var r=new(2==t.BYTES_PER_ELEMENT?k:4==t.BYTES_PER_ELEMENT?Z:j)(n-e);return r.set(t.subarray(e,n)),r},rt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ot=function(t,e,n){var r=new Error(e||rt[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,ot),!n)throw r;return r},it=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8},at=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},ut=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var o=n.length,i=n.slice();if(!o)return[pt,0];if(1==o){var a=new j(n[0].s+1);return a[n[0].s]=1,[a,1]}n.sort((function(t,e){return t.f-e.f})),n.push({s:-1,f:25001});var u=n[0],f=n[1],c=0,l=1,s=2;for(n[0]={s:-1,f:u.f+f.f,l:u,r:f};l!=o-1;)u=n[n[c].f<n[s].f?c++:s++],f=n[c!=l&&n[c].f<n[s].f?c++:s++],n[l++]={s:-1,f:u.f+f.f,l:u,r:f};var h=i[0].s;for(r=1;r<o;++r)i[r].s>h&&(h=i[r].s);var m=new k(h+1),p=ft(n[l-1],m,0);if(p>e){r=0;var v=0,d=p-e,g=1<<d;for(i.sort((function(t,e){return m[e.s]-m[t.s]||t.f-e.f}));r<o;++r){var y=i[r].s;if(!(m[y]>e))break;v+=g-(1<<p-m[y]),m[y]=e}for(v>>>=d;v>0;){var w=i[r].s;m[w]<e?v-=1<<e-m[w]++-1:++r}for(;r>=0&&v;--r){var x=i[r].s;m[x]==e&&(--m[x],++v)}p=e}return[new j(m),p]},ft=function(t,e,n){return-1==t.s?Math.max(ft(t.l,e,n+1),ft(t.r,e,n+1)):e[t.s]=n},ct=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new k(++e),r=0,o=t[0],i=1,a=function(t){n[r++]=t},u=1;u<=e;++u)if(t[u]==o&&u!=e)++i;else{if(!o&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(o),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(o);i=1,o=t[u]}return[n.subarray(0,r),e]},lt=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},st=function(t,e,n){var r=n.length,o=et(e+2);t[o]=255&r,t[o+1]=r>>>8,t[o+2]=255^t[o],t[o+3]=255^t[o+1];for(var i=0;i<r;++i)t[o+i+4]=n[i];return 8*(o+4+r)},ht=function(t,e,n,r,o,i,a,u,f,c,l){it(e,l++,n),++o[256];for(var s=ut(o,15),h=s[0],m=s[1],p=ut(i,15),v=p[0],d=p[1],g=ct(h),y=g[0],w=g[1],x=ct(v),b=x[0],L=x[1],E=new k(19),O=0;O<y.length;++O)E[31&y[O]]++;for(O=0;O<b.length;++O)E[31&b[O]]++;for(var I=ut(E,7),N=I[0],P=I[1],T=19;T>4&&!N[G[T-1]];--T);var A,M,F,S,U=c+5<<3,_=lt(o,K)+lt(i,Q)+a,z=lt(o,h)+lt(i,v)+a+14+3*T+lt(E,N)+(2*E[16]+3*E[17]+7*E[18]);if(U<=_&&U<=z)return st(e,l,t.subarray(f,f+c));if(it(e,l,1+(z<_)),l+=2,z<_){A=J(h,m,0),M=h,F=J(v,d,0),S=v;var j=J(N,P,0);it(e,l,w-257),it(e,l+5,L-1),it(e,l+10,T-4),l+=14;for(O=0;O<T;++O)it(e,l+3*O,N[G[O]]);l+=3*T;for(var Z=[y,b],C=0;C<2;++C){var V=Z[C];for(O=0;O<V.length;++O){var R=31&V[O];it(e,l,j[R]),l+=N[R],R>15&&(it(e,l,V[O]>>>5&127),l+=V[O]>>>12)}}}else A=$,M=K,F=tt,S=Q;for(O=0;O<u;++O)if(r[O]>255){R=r[O]>>>18&31;at(e,l,A[R+257]),l+=M[R+257],R>7&&(it(e,l,r[O]>>>23&31),l+=D[R]);var X=31&r[O];at(e,l,F[X]),l+=S[X],X>3&&(at(e,l,r[O]>>>5&8191),l+=Y[X])}else at(e,l,A[r[O]]),l+=M[r[O]];return at(e,l,A[256]),l+M[256]},mt=new Z([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),pt=new j(0),vt=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(1&n&&-306674912)^n>>>1;t[e]=n}return t}(),dt=function(){var t=-1;return{p:function(e){for(var n=t,r=0;r<e.length;++r)n=vt[255&n^e[r]]^n>>>8;t=n},d:function(){return~t}}},gt=function(t,e,n,r,o){return function(t,e,n,r,o,i){var a=t.length,u=new j(r+a+5*(1+Math.ceil(a/7e3))+o),f=u.subarray(r,u.length-o),c=0;if(!e||a<8)for(var l=0;l<=a;l+=65535){var s=l+65535;s>=a&&(f[c>>3]=i),c=st(f,c+1,t.subarray(l,s))}else{for(var h=mt[e-1],m=h>>>13,p=8191&h,v=(1<<n)-1,d=new k(32768),g=new k(v+1),y=Math.ceil(n/3),w=2*y,x=function(e){return(t[e]^t[e+1]<<y^t[e+2]<<w)&v},b=new Z(25e3),L=new k(288),E=new k(32),O=0,I=0,N=(l=0,0),P=0,T=0;l<a;++l){var A=x(l),M=32767&l,F=g[A];if(d[M]=F,g[A]=M,P<=l){var S=a-l;if((O>7e3||N>24576)&&S>423){c=ht(t,f,0,b,L,E,I,N,T,l-T,c),N=O=I=0,T=l;for(var U=0;U<286;++U)L[U]=0;for(U=0;U<30;++U)E[U]=0}var _=2,z=0,G=p,C=M-F&32767;if(S>2&&A==x(l-C))for(var V=Math.min(m,S)-1,R=Math.min(32767,l),H=Math.min(258,S);C<=R&&--G&&M!=F;){if(t[l+_]==t[l+_-C]){for(var W=0;W<H&&t[l+W]==t[l+W-C];++W);if(W>_){if(_=W,z=C,W>V)break;var q=Math.min(C,W-2),J=0;for(U=0;U<q;++U){var K=l-C+U+32768&32767,Q=K-d[K]+32768&32767;Q>J&&(J=Q,F=K)}}}C+=(M=F)-(F=d[M])+32768&32767}if(z){b[N++]=268435456|X[_]<<18|B[z];var $=31&X[_],tt=31&B[z];I+=D[$]+Y[tt],++L[257+$],++E[tt],P=l+_,++O}else b[N++]=t[l],++L[t[l]]}}c=ht(t,f,i,b,L,E,I,N,T,l-T,c),!i&&7&c&&(c=st(f,c+1,pt))}return nt(u,0,r+et(c)+o)}(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,r,!o)},yt=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n},wt=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function xt(t,e){return gt(t,e||{},0,0)}var bt=function(t,e,n,r){for(var o in t){var i=t[o],a=e+o,u=r;Array.isArray(i)&&(u=yt(r,i[1]),i=i[0]),i instanceof j?n[a]=[i,u]:(n[a+="/"]=[new j(0),u],bt(i,a,n,r))}},Lt="undefined"!=typeof TextEncoder&&new TextEncoder,Et="undefined"!=typeof TextDecoder&&new TextDecoder;try{Et.decode(pt,{stream:!0}),1}catch(t){}function Ot(t,e){if(e){for(var n=new j(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);return n}if(Lt)return Lt.encode(t);var o=t.length,i=new j(t.length+(t.length>>1)),a=0,u=function(t){i[a++]=t};for(r=0;r<o;++r){if(a+5>i.length){var f=new j(a+8+(o-r<<1));f.set(i),i=f}var c=t.charCodeAt(r);c<128||e?u(c):c<2048?(u(192|c>>6),u(128|63&c)):c>55295&&c<57344?(u(240|(c=65536+(1047552&c)|1023&t.charCodeAt(++r))>>18),u(128|c>>12&63),u(128|c>>6&63),u(128|63&c)):(u(224|c>>12),u(128|c>>6&63),u(128|63&c))}return nt(i,0,a)}var It=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;r>65535&&ot(9),e+=r+4}return e},Nt=function(t,e,n,r,o,i,a,u){var f=r.length,c=n.extra,l=u&&u.length,s=It(c);wt(t,e,null!=a?33639248:67324752),e+=4,null!=a&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(null==i&&8),t[e++]=o&&8,t[e++]=255&n.compression,t[e++]=n.compression>>8;var h=new Date(null==n.mtime?Date.now():n.mtime),m=h.getFullYear()-1980;if((m<0||m>119)&&ot(10),wt(t,e,m<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,null!=i&&(wt(t,e,n.crc),wt(t,e+4,i),wt(t,e+8,n.size)),wt(t,e+12,f),wt(t,e+14,s),e+=16,null!=a&&(wt(t,e,l),wt(t,e+6,n.attrs),wt(t,e+10,a),e+=14),t.set(r,e),e+=f,s)for(var p in c){var v=c[p],d=v.length;wt(t,e,+p),wt(t,e+2,d),t.set(v,e+4),e+=4+d}return l&&(t.set(u,e),e+=l),e};function Pt(t,e){e||(e={});var n={},r=[];bt(t,"",n,e);var o=0,i=0;for(var a in n){var u=n[a],f=u[0],c=u[1],l=0==c.level?0:8,s=(E=Ot(a)).length,h=c.comment,m=h&&Ot(h),p=m&&m.length,v=It(c.extra);s>65535&&ot(11);var d=l?xt(f,c):f,g=d.length,y=dt();y.p(f),r.push(yt(c,{size:f.length,crc:y.d(),c:d,f:E,m:m,u:s!=a.length||m&&h.length!=p,o:o,compression:l})),o+=30+s+v+g,i+=76+2*(s+v)+(p||0)+g}for(var w=new j(i+22),x=o,b=i-o,L=0;L<r.length;++L){var E=r[L];Nt(w,E.o,E,E.f,E.u,E.c.length);var O=30+E.f.length+It(E.extra);w.set(E.c,E.o+O),Nt(w,o,E,E.f,E.u,E.c.length,E.o,E.m),o+=16+O+(E.m?E.m.length:0)}return function(t,e,n,r,o){wt(t,e,101010256),wt(t,e+8,n),wt(t,e+10,n),wt(t,e+12,r),wt(t,e+16,o)}(w,o,r.length,b,x),w}function Tt(){var t,e,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a="object"===o(i)?n({},i):{},u="Shapefile",f="";"string"==typeof i?f=i:f=null!==(r=null==a?void 0:a.name)&&void 0!==r?r:u;var c=(null!==(t=f)&&void 0!==t?t:u).split(".")[0],l={name:c+".zip",types:{point:c,line:c,polygon:c}};return a.types=n(n({},l.types),null!==(e=null==a?void 0:a.types)&&void 0!==e?e:{}),n(n({},l),a)}function At(t,e){return Mt.apply(this,arguments)}function Mt(){return Mt=a(r().mark((function t(e,n){var o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Tt(n),o=[],[M.point(e),M.multipoint(e),M.line(e),M.multiline(e),M.polygon(e),M.pointZ(e),M.multipointZ(e),M.lineZ(e),M.multilineZ(e),M.polygonZ(e)].forEach((function(t){t.geometries.length&&t.geometries[0].length&&P(t.properties,t.type,t.geometries,(function(e,r){var i,a,f=n&&n.types[t.type.toLowerCase()]?n.types[t.type.toLowerCase()]:t.type;o.push(Pt((u(a={},f+".shp",new Uint8Array(r.shp.buffer)),u(a,f+".shx",new Uint8Array(r.shx.buffer)),u(a,f+".dbf",new Uint8Array(r.dbf.buffer)),u(a,f+".prj",Ot(null!==(i=n.wkt)&&void 0!==i?i:y)),a))),e&&console.warn("failed to create zip file: ",e)}))})),t.abrupt("return",new Blob(o,{type:"application/zip",filename:n.name}));case 5:case"end":return t.stop()}}),t)}))),Mt.apply(this,arguments)}var Ft={exports:{}};!function(t){
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var e=e||function(t){if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,n=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=/constructor/i.test(t.HTMLElement)||t.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),u=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},f=function(t){setTimeout((function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()}),4e4)},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},l=function(e,l,s){s||(e=c(e));var h,m=this,p="application/octet-stream"===e.type,v=function(){!function(t,e,n){for(var r=(e=[].concat(e)).length;r--;){var o=t["on"+e[r]];if("function"==typeof o)try{o.call(t,n||t)}catch(t){u(t)}}}(m,"writestart progress write writeend".split(" "))};if(m.readyState=m.INIT,o)return h=n().createObjectURL(e),void setTimeout((function(){var t,e;r.href=h,r.download=l,t=r,e=new MouseEvent("click"),t.dispatchEvent(e),v(),f(h),m.readyState=m.DONE}));!function(){if((a||p&&i)&&t.FileReader){var r=new FileReader;return r.onloadend=function(){var e=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,m.readyState=m.DONE,v()},r.readAsDataURL(e),void(m.readyState=m.INIT)}(h||(h=n().createObjectURL(e)),p)?t.location.href=h:t.open(h,"_blank")||(t.location.href=h);m.readyState=m.DONE,v(),f(h)}()},s=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=c(t)),navigator.msSaveOrOpenBlob(t,e)}:(s.abort=function(){},s.readyState=s.INIT=0,s.WRITING=1,s.DONE=2,s.error=s.onwritestart=s.onprogress=s.onwrite=s.onabort=s.onerror=s.onwriteend=null,function(t,e,n){return new l(t,e||t.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||c.content);t.exports&&(t.exports.saveAs=e)}(Ft),t.download=function(t,e){return e=Tt(e),new Promise((function(n,r){try{At(t,e).then((function(t){var r;Ft.exports.saveAs(t,null!==(r=e.name)&&void 0!==r?r:"Shapefile.zip"),n(!0)}))}catch(t){r(t)}}))},t.write=P,t.zip=At,Object.defineProperty(t,"__esModule",{value:!0})}));
